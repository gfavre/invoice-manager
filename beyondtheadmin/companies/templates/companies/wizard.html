{% extends 'base.html' %}
{% load i18n static crispy_forms_tags %}
{% block content %}
  <header class="page-header page-header-dark bg-gradient-primary pb-10">
    <div class="container-xl px-4">
      <div class="page-header-content pt-4">
        <div class="row align-items-center justify-content-between">
          <div class="col-auto mt-4">
            <h1 class="page-header-title">
              {% trans "Create company" %}

            </h1>
            <div class="page-header-subtitle">
              {% blocktrans %}Here you will create the company that will manage the invoices.{% endblocktrans %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>
  <section class="card card-header-actions mb-4">
    <header class="card-header ">

    </header>
    <article class="card-body" id="app" ref="app"
             data-autocomplete-url="{% url "api:companies-autocomplete" %}"
             data-company-detail-url="{% url "api:company-detail" %}"
             data-iban-url="{% url 'api:iban-lookup' %}?q="
    >
      <form action="{% url 'companies:wizard' %}" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="card-header border-bottom">
          <!-- Wizard navigation-->
          <div class="nav nav-pills nav-justified flex-column flex-xl-row nav-wizard" id="wizard-steps" role="tablist">
            <!-- Wizard navigation item 1-->

            <!-- find a way to add aria-selected="true" -->
            <a class="nav-item nav-link" href="#wizard1" data-bs-toggle="tab" role="tab"
               aria-controls="wizard1"
               :class="{'active': stepIndex === 1}" @click="stepIndex=1">
              <div class="wizard-step-icon">1</div>
              <div class="wizard-step-text">
                <div class="wizard-step-text-name">{% trans "Company" %}</div>
                <div class="wizard-step-text-details">{% trans "Contact informations"%}</div>
              </div>
            </a>
            <!-- Wizard navigation item 2-->
            <a class="nav-item nav-link" id="wizard2-tab" href="#wizard2" data-bs-toggle="tab" role="tab"
               aria-controls="wizard2"
               :class="{'active': stepIndex === 2, disabled: step1Invalid}" @click="stepIndex=2">
              <div class="wizard-step-icon">2</div>
              <div class="wizard-step-text">
                <div class="wizard-step-text-name">{% trans "Bank" %}</div>
                <div class="wizard-step-text-details">{% trans "Where will you get paid" %}</div>
              </div>
            </a>
            <!-- Wizard navigation item 3-->
            <a class="nav-item nav-link" id="wizard3-tab" href="#wizard3" data-bs-toggle="tab" role="tab"
               aria-controls="wizard3"
               :class="{'active': stepIndex === 3, disabled: step3NotClickable}" @click="stepIndex=3">
              <div class="wizard-step-icon">3</div>
              <div class="wizard-step-text">
                <div class="wizard-step-text-name">{% trans "Invoices" %}</div>
                <div class="wizard-step-text-details">{% trans "What will invoices look like" %}</div>
              </div>
            </a>

          </div>
        </div>

        <fieldset v-show="stepIndex===1" class="border-left-info shadow">
          <legend>{% trans "Step" %} 1</legend>
          <p class="lead">{% trans "Setup your company's contact informations" %}</p>
          <vue-typeahead-bootstrap
            v-model="query"
            :data="companies"
            :serializer="item => item.name + ', ' + item.city"
            min.matching-chars="3"
            placeholder="{% trans "Find company" %}"
            input-class="form-control-md"
            @input="companyLookup"
            @hit="selectedCompany = $event"
          >
            <template slot="append">
              <button class="btn btn-primary">
                {% trans "Search" %}
              </button>
            </template>

          </vue-typeahead-bootstrap>
          <br>

          {% crispy form_base %}
          <div class="buttonHolder">
            <input type="button" name="next-1" value="{% trans "Next" %}" class="btn btn btn-primary white"
                   @click="nextStep()" :disabled="step1Invalid"
            />
          </div>
        </fieldset>
        <fieldset v-show="stepIndex===2" class="border-left-warning shadow">
          <legend>{% trans "Step" %} 2</legend>
          <p class="lead">{% trans "Setup your banking informations to receive the payments" %}</p>

          {% crispy form_bank %}
          <div class="buttonHolder">
            <input type="button" name="prev-2" value="{% trans "Previous" %}" class="btn btn btn-secondary white"
                   @click="prevStep()"
            />
            <input type="button" name="next-2" value="{% trans "Next" %}" class="btn btn btn-primary white"
                   @click="nextStep()" :disabled="step2Invalid"
            />
          </div>
        </fieldset>
        <fieldset v-show="stepIndex==3" class="border-left-primary shadow">
          <legend>{% trans "Step" %} 3</legend>
          <p class="lead">{% trans "Setup the invoices' look and feel" %}</p>

          {% crispy form_invoices %}
          <div class="buttonHolder">
            <input type="button" name="prev-3" value="{% trans "Previous" %}" class="btn btn btn-secondary white"
                   @click="prevStep()"
            />
            <input type="submit" value="{% trans "Save" %}" class="btn btn btn-primary white" :disabled="!submittable">
          </div>
        </fieldset>

      </form>
    </article>

  </section>

{% endblock content %}

{% block javascript %}
  {{ block.super }}
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
  <script type="module" src="{% static 'js/wizard.js' %}"></script>
{% endblock %}
